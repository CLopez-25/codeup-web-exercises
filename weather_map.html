<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <!-- JavaScript Keys -->
    <script src="js/keys.js"></script>
    <!-- CSS Bootstrap only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- JavaScript Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <!-- Mapbox API -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet' />
    <!-- Utils Functions -->
    <script src="js/utils.js"></script>
</head>
<!--<body>-->
<!--    &lt;!&ndash; Navbar & Place Search &ndash;&gt;-->
<!--    <nav class="navbar navbar-dark bg-primary">-->
<!--        <div class="container-fluid">-->
<!--            <span class="navbar-text" style="color: white">-->
<!--            Weather App-->
<!--            </span>-->
<!--        </div>-->
<!--    </nav>-->
<!--        <form class="mx-4 mt-2 w-20">-->
<!--            <label for="find" class="justify-content-end">Place</label>-->
<!--            <input type="text" name="find" id="find" class="my-2">-->
<!--            <button id="findButton" class="bg-primary mx-2" style="color: white">Find</button>-->
<!--        </form>-->
<!--    &lt;!&ndash; Navbar & Place Search End &ndash;&gt;-->
<!--    <div id="weatherCards"></div>-->
<!--    &lt;!&ndash; Map Div &ndash;&gt;-->
<!--    <div>-->
<!--        <div class="container row mx-auto">-->
<!--            <div id='map' class="mx-auto mt-4" style="width: 100%; height: 250px"></div>-->
<!--        </div>-->
<!--    </div>-->
<!--    -->
<script src="js/jquery-3.6.1.min.js"></script>
<script src="js/weather_map.js"></script>
<!--<script>-->
<!--    mapboxgl.accessToken = MAPBOX_API_TOKEN;-->
<!--    const map = new mapboxgl.Map({-->
<!--        container: 'map', // container ID-->
<!--        style: 'mapbox://styles/mapbox/dark-v10', // style URL-->
<!--        center: [-98.4916, 29.4252], // starting position [lng, lat]-->
<!--        zoom: 10, // starting zoom-->
<!--        projection: 'globe' // display the map as a 3D globe-->
<!--    });-->
<!--    map.on('style.load', () => {-->
<!--        map.setFog({}); // Set the default atmosphere style-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <!-- JavaScript Keys -->
    <script src="js/keys.js"></script>
    <!-- CSS Bootstrap only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- JavaScript Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <!-- Mapbox API -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet' />
    <!-- Utils Functions -->
    <script src="js/utils.js"></script>
</head>
<body>
<div class="head">
    <h1>MyWeather App</h1>
    <div class="searchBar">
        <button id="btn">Search</button>
        <div class="searchBar">
            <label for="input"></label>
            <input type="text" id="input" placeholder="Type an address..">
        </div>
    </div>
</div>


<div class="mapping">
    <div id='map' style='width: 800px; height: 300px;'></div>
</div>

<div id="weather" class="row">
</div>

<script src="js/jquery-3.6.1.min.js"></script>
<script src="js/weather_map.js"></script>
<script>
    // map
    mapboxgl.accessToken = MAPBOX_API_TOKEN;
    let map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: [-98.4936, 29.4241], // starting position [lng, lat]
        zoom: 9 // starting zoom
    });
    // map marker
    let marker = new mapboxgl.Marker({
        color: 'rgba(1,1,1,.3)',
    })
        .setLngLat([-98.4936, 29.4241])
        .setDraggable(true)
        .addTo(map);

    marker.on('dragend', function () {
        let newCenter = marker.getLngLat().toArray();
        $('#weather').html('');
        marker.setLngLat(newCenter);
        map.flyTo({center: newCenter});
        weather([marker.getLngLat().lng, marker.getLngLat().lat]);
    });

    // searchbar
    $("#btn").click(function() {
        let userInput = $("#input").val();
        geocode(userInput, MAPBOX_API_TOKEN).then(function (info) {
            console.log(info);
            let newCenter = {
                lng: info[0],
                lat: info[1]
            };
            $('#weather').html('');
            marker.setLngLat(newCenter);
            map.flyTo({center: newCenter});
            weather([marker.getLngLat().lng, marker.getLngLat().lat]);
        });
    });

    // weather info grabber
    function weather(x) {

        $.get("https://api.openweathermap.org/data/2.5/onecall?units=imperial&lat=" + x[1] + "&lon=" + x[0] + "&exclude=current,hourly,minutely&appid=" + OPEN_WEATHER_APPID)
            .done(function (resp) {
                console.log(resp);
                let htmlStr= "";
                for (let i =0;i <= 4; i++) {
                    let today = resp.daily[i];
                    let todayDate = new Date(today.dt * 1000);
                    let dateToday= todayDate.toDateString()
                    let description = resp.daily[i].weather[0].description
                    let capDesc = description[0].toUpperCase() + description.substring(1);
                    let high = resp.daily[i].temp.min
                    let low = resp.daily[i].temp.max
                    let humidity = resp.daily[i].humidity
                    let windSpeed = resp.daily[i].wind_speed
                    // icon grabber
                    let iconcode = resp.daily[i].weather[0].icon;
                    let iconurl = 'http://openweathermap.org/img/w/' + iconcode + '.png';
                    $('#wicon').attr('src', iconurl);
                    // backgorund changer
                    if (resp.daily[0].weather[0].main === 'Rain') {$("body").css("background-image", "url('images/Raindrops-Video-Background-HD-1080p-GIF.gif')");
                    } else if (resp.daily[0].weather[0].main === 'Clouds') {$("body").css("background-image", "url('https://images.pexels.com/photos/844297/pexels-photo-844297.jpeg?cs=srgb&dl=pexels-eberhard-grossgasteiger-844297.jpg&fm=jpg')");
                    } else if (resp.daily[0].weather[0].main === 'Clear') {$("body").css("background-image", "url('https://images.pexels.com/photos/754419/pexels-photo-754419.jpeg?cs=srgb&dl=pexels-john-tekeridis-754419.jpg&fm=jpg')");
                    } else {$("body").css("background-image", "url('https://images.pexels.com/photos/1162251/pexels-photo-1162251.jpeg?cs=srgb&dl=pexels-andre-furtado-1162251.jpg&fm=jpg')");
                    }


                    // info to html
                    htmlStr += "<div class='card col-2' style='width: 18rem;'>";
                    htmlStr += '<div id="icon" class="card-header">' + '<img id="wicon" src="http://openweathermap.org/img/w/' + iconcode + '.png" alt="weather icon">' + dateToday + '</div>';
                    htmlStr += '<ul class="list-group list-group-flush">'
                    htmlStr += '<li class="list-group-item">' + "Description: " + capDesc + '</li>';
                    htmlStr += '<li class="list-group-item">' + "Temp (High/Low): " + Math.round(high) + "/" + Math.round(low) + "Â°" + '</li>';
                    htmlStr += '<li class="list-group-item">' + "Humidity: " + humidity + '%' + '</li>';
                    htmlStr += '<li class="list-group-item">' + "Wind Speed: " + Math.round(windSpeed)+ '</li>';
                    htmlStr += '</div>';
                }
                $('#weather').append(htmlStr)
            });
    }

    weather([marker.getLngLat().lng, marker.getLngLat().lat]);
    console.log(marker.getLngLat());
</script>
</body>
</html>